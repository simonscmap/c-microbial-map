BootStrap: docker
From: r-base:3.5.2

%environment
    PATH=/app/c-microbial-map/scripts:$PATH

%runscript
    exec Rscript /app/c-microbial-map/scripts/blast2cmap.py

%post
    apt-get update
    apt-get install git -y python3 python3-pip ncbi-blast+ unixodbc unixodbc-dev
    python3 -m pip install pyodbc opedia # snakemake

    mkdir /app
    cd /app
    git clone https://github.com/simonscmap/c-microbial-map.git

    /app/c-microbial-map/blast/mk-blast-db.sh

    #
    # Install R modules (need the .Rprofile to indicate CRAN mirror)
    #
#    cat << EOF > .Rprofile
#local({
#  r = getOption("repos")
#  r["CRAN"] = "http://mirrors.nics.utk.edu/cran/"
#  options(repos = r)
#})
#EOF

#    Rscript /app/c-microbial-map/scripts/install.r
  
    # Mount points for TACC directories
    mkdir /home1
    mkdir /scratch
    mkdir /work
